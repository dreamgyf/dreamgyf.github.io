<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="你真的了解Emoji吗？Emoji全貌大揭秘"><meta name="keywords" content="Emoji"><meta name="author" content="dreamgyf"><meta name="copyright" content="dreamgyf"><title>你真的了解Emoji吗？Emoji全貌大揭秘 | 始终都是梦</title><link rel="shortcut icon" href="/images/avatar.jpeg"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '4.2.1'
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#起因"><span class="toc-number">2.</span> <span class="toc-text">起因</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Emoji的起源及发展"><span class="toc-number">3.</span> <span class="toc-text">Emoji的起源及发展</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unicode"><span class="toc-number">4.</span> <span class="toc-text">Unicode</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UTF-16"><span class="toc-number">5.</span> <span class="toc-text">UTF-16</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Emoji规则"><span class="toc-number">6.</span> <span class="toc-text">Emoji规则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本Emoji"><span class="toc-number">6.1.</span> <span class="toc-text">基本Emoji</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复合Emoji"><span class="toc-number">6.2.</span> <span class="toc-text">复合Emoji</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#旗帜"><span class="toc-number">6.2.1.</span> <span class="toc-text">旗帜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#肤色修饰符"><span class="toc-number">6.2.2.</span> <span class="toc-text">肤色修饰符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变体选择符"><span class="toc-number">6.2.3.</span> <span class="toc-text">变体选择符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#键帽符"><span class="toc-number">6.2.4.</span> <span class="toc-text">键帽符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#标签序列"><span class="toc-number">6.2.5.</span> <span class="toc-text">标签序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#零宽度连接符"><span class="toc-number">6.2.6.</span> <span class="toc-text">零宽度连接符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Emoji字体"><span class="toc-number">7.</span> <span class="toc-text">Emoji字体</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#回归初心，如何解决流式打印问题"><span class="toc-number">8.</span> <span class="toc-text">回归初心，如何解决流式打印问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考文献"><span class="toc-number">9.</span> <span class="toc-text">参考文献</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#工具"><span class="toc-number">10.</span> <span class="toc-text">工具</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.jpeg"></div><div class="author-info__name text-center">dreamgyf</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">41</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">44</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">29</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/images/background.jpeg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">始终都是梦</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">你真的了解Emoji吗？Emoji全貌大揭秘</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2024-08-10</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>随着科技发展，智能手机的普及，<code>Emoji</code>已经融入到了我们的生活中，但每天使用<code>Emoji</code>的你真的清楚它是什么，是由什么东西组成的，和普通的字符有什么区别吗？本文就从技术的角度带你揭秘<code>Emoji</code>的全貌。</p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>最近项目里有一个AI聊天机器人，你可以向他提问，他会以流式打印的形式一字一字的将回答呈现给用户。在这过程中我就发现，每当打印到<code>Emoji</code>的时候，总会先出现一个问号形状的乱码，然后才能显示出<code>Emoji</code>，有的<code>Emoji</code>更奇特，以👨‍👩‍👧‍👦为例，在打印过程中会依此显示👨👩👧👦四个<code>Emoji</code>，最后突然啪的一下，合成一整个👨‍👩‍👧‍👦，是不是很神奇？这个现象引起了我的好奇，于是我开始翻阅资料，揭开<code>Emoji</code>的神秘面纱。</p>
<h1 id="Emoji的起源及发展"><a href="#Emoji的起源及发展" class="headerlink" title="Emoji的起源及发展"></a>Emoji的起源及发展</h1><p><code>Emoji</code>来自日语词汇”絵文字”（假名为“えもじ”，读音即 emoji），绘指图画，文字指字符，最早由栗田穰崇（Shigetaka Kurita）创作，设计灵感源于天气预报图标、汉字、漫画和路标等，最初的<code>Emoji</code>有176个，都是12 x 12像素的图片。</p>
<p>1999年，日本通讯运营商DOCOMO公司发布了在当时具有跨时代意义的iMode手机，最早的<code>Emoji</code>便搭载于其中。</p>
<p><code>Emoji</code>一经诞生，人们便发现这些形象的<code>Emoji</code>实在是太好用了，不仅方便，还能使聊天过程更加有趣，随即便立刻被日本各大科技公司注意到，日本的三大运营商开始把<code>Emoji</code>加入到自己的短信业务中，很快便横扫了全日本，但为了打击竞争对手，各大运营商都使用自己的<code>Emoji</code>标准。这导致了不同运营商的手机无法正常显示对方手机发的<code>Emoji</code>。</p>
<p>苹果是<code>Emoji</code>传遍全球的最大功臣。为了把<code>iPhone</code>打入日本市场，苹果决定在<code>iOS 2.2</code>中加入日本消费者的最爱emoji，为了迎合日本市场，他们在3个月的时间推出了400多个表情符号，极大地拓展了<code>Emoji</code>的表情数量，那时的<code>iOS Emoji</code>只在日本地区可用，但“好景不长”，北美的<code>iOS 2.2</code>用户发现了隐藏在系统中的<code>Emoji</code>，之后<code>Emoji</code>很快流行了起来，这种现象得到了其它科技公司的注意。</p>
<p>随着<code>Emoji</code>的流行，2010年，<code>Emoji</code> 首次被纳入<code>Unicode v6.0</code>字符集中。每个字符（表情）都被设定了统一且唯一的二进制码，从而保障了各平台手机都能使用<code>Emoji</code>，截止撰文期间，最新的<code>Unicode v15.1</code>字符集中已有3782个<code>Emoji</code>字符，而更新的<code>Unicode v16</code>版本预计于2024年9月发布release，届时会有更多的<code>Emoji</code>被支持。</p>
<h1 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h1><p>既然<code>Emoji</code>被<code>Unicode</code>所收纳，那我们必先得去了解<code>Unicode</code>。</p>
<p>广义上的<code>Unicode</code>是一个标准，定义了<code>Unicode</code>字符集以及一系列的编码规则，是一种收录了世界上所有语言的文字和符号的全球标准。</p>
<p>那么<code>Unicode</code>是怎样收录如此庞大的字符内容呢？很简单，给每个字符指定一个编号就行了，在<code>Unicode</code>中被称为<code>码点</code>（<code>CodePoint</code>），它的表现形式为<code>U+</code>后面跟上一个十六进制数，比如<code>U+0041</code>表示大写字母<code>A</code>。</p>
<p>世界上有那么多字符，<code>Unicode</code>并不是一次性定义的，而是分区定义，每个区可以存放 65536 (<code>2^16</code>) 个字符，称为一个平面（Plane），目前<code>Unicode</code>从第0平面到第16平面总共有17个平面，其中第0平面被称为基本平面（BMP），它的码点范围从0一直到65535，写成十六进制也就是 <code>U+0000</code> - <code>U+FFFF</code> ，所有的常见字符都被放在这个平面，这是<code>Unicode</code>最先定义和公布的一个平面，而剩下的平面被称为辅助平面，码点范围从 <code>U+010000</code> 一直到 <code>U+10FFFF</code></p>
<h1 id="UTF-16"><a href="#UTF-16" class="headerlink" title="UTF-16"></a>UTF-16</h1><p><code>Unicode</code>字符集只规定了每个字符的码点，但这一个个码点应该被计算机传输识别呢？这就涉及到编码的概念了，目前<code>Unicode</code>实际应用使用的编码方式为<code>UCS-2</code>，也就是每个字符占用2个字节，<code>Unicode</code>还有一种4字节的编码方式<code>UCS-4</code>，但这里不做讨论。</p>
<p>使用<code>UCS-2</code>编码方式包含65536个字符空间（2个字节的可用空间即为<code>2^16</code>），对应着表示着<code>Unicode</code>字符集中的基本平面，那剩余的辅助平面又该如何表示呢？<code>UTF-16</code>应运而生。</p>
<p><code>UTF-16</code>是<code>UCS-2</code>的超集，是一种变长编码，它的编码规则很简单：基本平面的字符占用2个字节，辅助平面的字符占用4个字节，也就是说<code>UTF-16</code>的编码长度要么是2个字节（<code>U+0000</code>-<code>U+FFFF</code>），要么是4个字节（<code>U+010000</code>-<code>U+10FFFF</code>）。</p>
<p>那么问题来了，采用<code>UTF-16</code>编码的时候，我们该怎么判断这个字符占用的是2个字节还是4个字节呢？这里有个巧妙的方式，在<code>Unicode</code>的基本平面中，从<code>U+D800</code>到<code>U+DFFF</code>是一个空段，即这些码点不对应任何字符，因此，这个空段可以用来映射辅助平面的字符。辅助平面的字符一共有<code>2^20</code>个（一个平面<code>2^16</code>个字符 * 16个平面(<code>2^4</code>)），因此表示这些字符至少需要20个二进制位。<code>UTF-16</code>将这20个二进制位分成两半，前10位映射在<code>U+D800</code>到<code>U+DBFF</code>（<code>UTF-16</code>的高半区，空间大小<code>2^10</code>），称为高位（H），后10位映射在<code>U+DC00</code>到<code>U+DFFF</code>（<code>UTF-16</code>的低半区，空间大小<code>2^10</code>），称为低位（L）。这意味着，一个辅助平面的字符，被拆成两个基本平面的字符表示。</p>
<p>因此，每当程序遇到2个字节时，便会去判断它的码元是否在<code>U+D800</code>到<code>U+DBFF</code>之间，如果在的话则可以假定它是一个4字节的字符，此时接着往后读2个字节，如果这2个字节的的码元在<code>U+DC00</code>到<code>U+DFFF</code>之间，将他们组合起来获得到实际字符；而如果不在的话则可以判定为是一个2字节的字符。</p>
<p>我们以<code>Java</code>中获取码点的方法<code>Character.codePointAt</code>为例来解读一下代码中如何获取一个字符的码点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> MIN_HIGH_SURROGATE = <span class="string">'\uD800'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> MAX_HIGH_SURROGATE = <span class="string">'\uDBFF'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> MIN_LOW_SURROGATE  = <span class="string">'\uDC00'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> MAX_LOW_SURROGATE  = <span class="string">'\uDFFF'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SUPPLEMENTARY_CODE_POINT = <span class="number">0x010000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">codePointAt</span><span class="params">(CharSequence seq, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c1 = seq.charAt(index);</span><br><span class="line">        <span class="comment">// 码元在 U+D800 到 U+DBFF 之间，并且下一个char的index没到结尾</span></span><br><span class="line">        <span class="keyword">if</span> (isHighSurrogate(c1) &amp;&amp; ++index &lt; seq.length()) &#123;</span><br><span class="line">            <span class="keyword">char</span> c2 = seq.charAt(index);</span><br><span class="line">            <span class="comment">// 下一个char的码元在 U+DC00 到 U+DFFF 之间</span></span><br><span class="line">            <span class="keyword">if</span> (isLowSurrogate(c2)) &#123;</span><br><span class="line">                <span class="comment">// 组合起来获得完整字符的码点</span></span><br><span class="line">                <span class="keyword">return</span> toCodePoint(c1, c2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 字符码点即是单个char的码元</span></span><br><span class="line">        <span class="keyword">return</span> c1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 码元是否在 U+D800 到 U+DBFF 之间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isHighSurrogate</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Help VM constant-fold; MAX_HIGH_SURROGATE + 1 == MIN_LOW_SURROGATE</span></span><br><span class="line">        <span class="keyword">return</span> ch &gt;= MIN_HIGH_SURROGATE &amp;&amp; ch &lt; (MAX_HIGH_SURROGATE + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 码元是否在 U+DC00 到 U+DFFF 之间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLowSurrogate</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ch &gt;= MIN_LOW_SURROGATE &amp;&amp; ch &lt; (MAX_LOW_SURROGATE + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算规则：</span></span><br><span class="line"><span class="comment">     * 1. 高位上的码元减掉高半区的起始值 0xD800 ，然后左移10位</span></span><br><span class="line"><span class="comment">     * 2. 低位上的码元减掉低半区的起始值 0xDC00</span></span><br><span class="line"><span class="comment">     * 3. 将 1 和 2 的计算结果以及辅助平面的起始值 0x010000 相加，获取到完整的码点值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">toCodePoint</span><span class="params">(<span class="keyword">char</span> high, <span class="keyword">char</span> low)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Optimized form of:</span></span><br><span class="line">        <span class="comment">// return ((high - MIN_HIGH_SURROGATE) &lt;&lt; 10)</span></span><br><span class="line">        <span class="comment">//         + (low - MIN_LOW_SURROGATE)</span></span><br><span class="line">        <span class="comment">//         + MIN_SUPPLEMENTARY_CODE_POINT;</span></span><br><span class="line">        <span class="keyword">return</span> ((high &lt;&lt; <span class="number">10</span>) + low) + (MIN_SUPPLEMENTARY_CODE_POINT</span><br><span class="line">                                       - (MIN_HIGH_SURROGATE &lt;&lt; <span class="number">10</span>)</span><br><span class="line">                                       - MIN_LOW_SURROGATE);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Emoji规则"><a href="#Emoji规则" class="headerlink" title="Emoji规则"></a>Emoji规则</h1><p>了解了<code>Unicode</code>标准后，我们回过头来思考一下，是不是说<code>Emoji</code>在<code>Unicode</code>标准中也仅仅只是被当成普通的字符看待呢？当然并非如此，除了之前说的平面规则等，<code>Emoji</code>在<code>Unicode</code>中还有一套自己的规则，这些规则都可以在 <a href="https://www.unicode.org/reports/tr51/" target="_blank" rel="noopener">Unicode 技术标准 #51 Emoji</a> 中找到，官方的文档乍一看可能比较难理解，接下来就由我来给大家做一个解读。</p>
<p>首先，<code>Emoji</code>在大类上可以分成两种，一种是基本<code>Emoji</code>，一种是多字符组合而成的复合<code>Emoji</code></p>
<h2 id="基本Emoji"><a href="#基本Emoji" class="headerlink" title="基本Emoji"></a>基本Emoji</h2><p>什么是基本<code>Emoji</code>呢？指的是直接在<code>Unicode</code>字符集里定义的一个<code>Emoji</code>字符，大多数基本<code>Emoji</code>字符都被划归到<code>U+1F300</code>-<code>U+1F6FF</code>和<code>U+1F900</code>-<code>U+1FAFF</code>这两个区域</p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_%E5%9F%BA%E6%9C%ACEmoji_U+1F300-U+1F6FF.png" alt="基本Emoji U+1F300-U+1F6FF"></p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_%E5%9F%BA%E6%9C%ACEmoji_U+1F900-U+1FAFF.png" alt="基本Emoji U+1F900-U+1FAFF"></p>
<p>具体都有哪些基本<code>Emoji</code>字符，我们可以在<code>Unicode</code>的官网文档 <a href="https://www.unicode.org/Public/UCD/latest/ucd/emoji/emoji-data.txt" target="_blank" rel="noopener">emoji-data</a> 中找到</p>
<h2 id="复合Emoji"><a href="#复合Emoji" class="headerlink" title="复合Emoji"></a>复合Emoji</h2><p>所谓的复合<code>Emoji</code>（我自己取的名字）指的是由多个字符组成的<code>Emoji</code>，它有着多种构造方式</p>
<p>在 <a href="https://www.unicode.org/reports/tr51/" target="_blank" rel="noopener">Unicode 技术标准 #51 Emoji</a> 中的<code>1.4.9</code>小节中，我们可以找到<code>Unicode</code>对<code>Emoji</code>定义的正则表达式，接下来我们就通过对这个正则表达式进行一步步的解析来了解<code>Emoji</code>的组成规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">\p&#123;RI&#125; \p&#123;RI&#125; </span><br><span class="line">| \p&#123;Emoji&#125; </span><br><span class="line">  ( \p&#123;EMod&#125; </span><br><span class="line">  | \x&#123;FE0F&#125; \x&#123;20E3&#125;? </span><br><span class="line">  | [\x&#123;E0020&#125;-\x&#123;E007E&#125;]+ \x&#123;E007F&#125;</span><br><span class="line">  )?</span><br><span class="line">  (\x&#123;200D&#125;</span><br><span class="line">    ( \p&#123;RI&#125; \p&#123;RI&#125;</span><br><span class="line">    | \p&#123;Emoji&#125;</span><br><span class="line">      ( \p&#123;EMod&#125; </span><br><span class="line">      | \x&#123;FE0F&#125; \x&#123;20E3&#125;? </span><br><span class="line">      | [\x&#123;E0020&#125;-\x&#123;E007E&#125;]+ \x&#123;E007F&#125;</span><br><span class="line">      )?</span><br><span class="line">    )</span><br><span class="line">  )*</span><br></pre></td></tr></table></figure>

<h3 id="旗帜"><a href="#旗帜" class="headerlink" title="旗帜"></a>旗帜</h3><p>首先我们看第一行的匹配条件<code>\p{RI} \p{RI}</code>，这里的<code>\p{RI}</code>全称为<code>Regional Indicator</code>，翻译成中文就是区域指示符，根据这行正则我们可以了解到，两个区域指示符连接便可组成一个<code>Emoji</code>，那么这个区域指示符是什么呢？</p>
<p>通过 <a href="https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E6%8C%87%E7%A4%BA%E7%AC%A6" target="_blank" rel="noopener">维基百科</a> 我们可以得知，区域指示符指的是从<code>U+1F1E6</code>到<code>U+1F1FF</code>中的字符，位于<code>Unicode</code>第一辅助平面的带圈字母数字补充区块内。</p>
<p>正如区块描述所说，这些字符看起来就像是一个个英文字母，外面套了个方框，这里是完整的字符表：🇦 🇧 🇨 🇩 🇪 🇫 🇬 🇭 🇮 🇯 🇰 🇱 🇲 🇳 🇴 🇵 🇶 🇷 🇸 🇹 🇺 🇻 🇼 🇽 🇾 🇿，通过两两组合的方式，将它们拼成国家或地区的代号，我们就能得到该国家或地区的旗帜。</p>
<p>以中国🇨🇳举例，中国的代号为<code>CN</code>，那我们就将🇨和🇳两个字符拼接到一起，便能得到中国国旗🇨🇳</p>
<h3 id="肤色修饰符"><a href="#肤色修饰符" class="headerlink" title="肤色修饰符"></a>肤色修饰符</h3><p>第二行的<code>\p{Emoji}</code>指的就是我们之前说过的基本<code>Emoji</code>，这个是构成除旗帜外的复合<code>Emoji</code>的基础条件，接着我们看正则的第三到第六行，这里用括号括起了一个条件，括号的尾部跟了一个问号，表示括号中的这个条件最多只可以出现一次（0次或1次），括号内的条件又是由三个子条件组成，用或号分割，满足任意一条条件则视为整个条件成立，我们首先看第一个子条件<code>\p{EMod}</code>。</p>
<p>全世界的人们都希望拥有反映更多人类多样性的<code>Emoji</code>，尤其是对于肤色。<code>Unicode v8.0</code>（2015年中）发行了五个为人类表情符号提供一系列肤色的符号修饰符符，具体的修饰符以及效果由下图所示：</p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_%E8%82%A4%E8%89%B2%E4%BF%AE%E9%A5%B0%E7%AC%A6.png" alt="肤色修饰符"></p>
<p>我们以基本<code>Emoji</code>✋为例，它的码点是<code>U+270B</code>，在他后面加上<code>U+1F3FB</code>，这个<code>Emoji</code>就变成了✋🏻，同样的：</p>
<ul>
<li>✋ + <code>U+1F3FC</code> = ✋🏼</li>
<li>✋ + <code>U+1F3FD</code> = ✋🏽</li>
<li>✋ + <code>U+1F3FE</code> = ✋🏾</li>
<li>✋ + <code>U+1F3FF</code> = ✋🏿</li>
</ul>
<h3 id="变体选择符"><a href="#变体选择符" class="headerlink" title="变体选择符"></a>变体选择符</h3><p>接着，我们再看第二个子条件<code>x{FE0F} \x{20E3}?</code>，这里的<code>x{FE0F}</code>指的是<code>变体选择符-16</code>（<code>Variation Selector-16</code>），那么首先，什么是变体选择符呢？</p>
<p>实际上，支持象形文字的字体最早可以追溯到1993年，我们可以看一下<code>Unicode</code>字符集的装饰符号区<code>U+2700</code>-<code>U+27FF</code></p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_%E8%A3%85%E9%A5%B0%E7%AC%A6%E5%8F%B7%E5%8C%BA.png" alt="装饰符号区"></p>
<p>那如果<code>Emoji</code>想要在这些象形文字的基础上做扩展，添加颜色，使其更加生动怎么办？没错，此时就需要使用到变体选择符了。</p>
<p>变体选择符（简称VS）是一个基本多文种平面的<code>Unicode</code>区段，包括16个变体选择符。这些选择器用于描述前一个字符的特点字形。目前 <code>Unicode</code>已定义数学符号、绘文字、八思巴字母及中日韩统一表意文字所对应的中日韩兼容表意文字。目前<code>Unicode</code>仅定义 VS1, VS2, VS3, VS15 及 VS16，VS15 和 VS16 分别用于标示某字符应该显示为普通文字或者是<code>Emoji</code>，这些字符被命名为<code>U+FE00</code>（VS1）至<code>U+FE0F</code>(VS16)。选择符仅应用于前一个字符。</p>
<p>以刚才我们在装饰符号区中看到的剪刀符号✂<code>U+2702</code>为例，在它的后面加上VS16 <code>U+FE0F</code>，这个字符就变成了<code>Emoji</code>✂️，是不是很神奇</p>
<h3 id="键帽符"><a href="#键帽符" class="headerlink" title="键帽符"></a>键帽符</h3><p>看完了变体选择符后，我们紧接着会疑惑，那这个条件后面的<code>\x{20E3}</code>又是啥呢？它被称为<code>COMBINING ENCLOSING KEYCAP</code>，它对前置的字符有一定的要求，只对数字、星号和井号生效，也就是说仅仅支持<code>*#0123456789</code>这12个字符。</p>
<p>它的规则是，当开头为这12个字符中的一个时，后面加上VS16 <code>U+FE0F</code>变成一个<code>Emoji</code>，然后在加上它<code>U+20E3</code>，这个字符就会变成一个键帽形状的字符：#️⃣ *️⃣ 0️⃣ 1️⃣ 2️⃣ 3️⃣ 4️⃣ 5️⃣ 6️⃣ 7️⃣ 8️⃣ 9️⃣</p>
<h3 id="标签序列"><a href="#标签序列" class="headerlink" title="标签序列"></a>标签序列</h3><p>然后是最后一个子条件<code>[\x{E0020}-\x{E007E}]+ \x{E007F}</code>，这是一个标签序列，它由一个基础黑旗符号，一系列标签字符以及一个标签终止符组成，首先以基础黑旗符号🏴<code>U+1F3F4</code>开头，然后中间是一系列的<code>U+E0020</code>到<code>U+E007E</code>之间的字符，最后以标签终止符<code>U+E007F</code>结尾，这样就组成了一个标签序列<code>Emoji</code>。</p>
<p>目前这种<code>Emoji</code>不太常见，仅仅只有英格兰、苏格兰和威尔士的旗帜使用标签序列：</p>
<ul>
<li>🏴 + <code>U+E0067</code> + <code>U+E0062</code> + <code>U+E0065</code> + <code>U+E006E</code> + <code>U+E0067</code> + <code>U+E007F</code> = 🏴󠁧󠁢󠁥󠁮󠁧󠁿</li>
<li>🏴 + <code>U+E0067</code> + <code>U+E0062</code> + <code>U+E0073</code> + <code>U+E0063</code> + <code>U+E0074</code> + <code>U+E007F</code> = 🏴󠁧󠁢󠁳󠁣󠁴󠁿</li>
<li>🏴 + <code>U+E0067</code> + <code>U+E0062</code> + <code>U+E0077</code> + <code>U+E006C</code> + <code>U+E0073</code> + <code>U+E007F</code> = 🏴󠁧󠁢󠁷󠁬󠁳󠁿</li>
</ul>
<h3 id="零宽度连接符"><a href="#零宽度连接符" class="headerlink" title="零宽度连接符"></a>零宽度连接符</h3><p>这些子条件看完，我们再回归到正则表达式中来，可以观察到8到14行的条件和1到6行的条件其实是完全一样的，而在第7行出现了一个条件<code>\x{200D}</code>连接了这两个一样的条件，什么意思呢？</p>
<p>没错，结合本文的起因部分，我们很容易的就可以联想到，这个<code>\x{200D}</code>起到的就是连接作用，它被称为零宽度连接符（<code>ZERO-WIDTH JOINER</code>，简称<code>ZWJ</code>），通过上面正则表达式尾部的*号我们可以得知，通过这个连接符，可以连接多个<code>Emoji</code>合成新的<code>Emoji</code>，下面举几个有趣的例子：</p>
<ul>
<li>👩<code>U+1F469</code> + <code>U+200D</code> + ✈️<code>U+2708 U+FE0F</code> = 👩‍✈️</li>
<li>👨<code>U+1F468</code> + <code>U+200D</code> + 💻<code>U+1F4BB</code> = 👨‍💻</li>
<li>🐻<code>U+1F43B</code> + <code>U+200D</code> + ❄️<code>U+2744 U+FE0F</code> = 🐻‍❄️</li>
<li>🏴<code>U+1F3F4</code> + <code>U+200D</code> + ☠️<code>U+2620 U+FE0F</code> = 🏴‍☠️</li>
<li>🏳️<code>U+1F3F3 U+FE0F</code> + <code>U+200D</code> + 🌈<code>U+1F308</code> = 🏳️‍🌈</li>
</ul>
<p>以上是由两个<code>Emoji</code>组成一个新的<code>Emoji</code>的例子，而家庭以及人际关系相关的<code>Emoji</code>通常会由更多<code>Emoji</code>构成，就拿本文开头提到的例子👨‍👩‍👧‍👦，它的构成实际上是这样的：</p>
<p>👨<code>U+1F468</code> + <code>U+200D</code> + 👩<code>U+1F469</code> + 👧<code>U+1F467</code> + 👦<code>U+1F466</code> = 👨‍👩‍👧‍👦</p>
<p>这也就解释了在AI聊天机器人流式打印文字的时候，为什么会依此显示👨👩👧👦四个<code>Emoji</code>，最后突然合成一整个👨‍👩‍👧‍👦了</p>
<h1 id="Emoji字体"><a href="#Emoji字体" class="headerlink" title="Emoji字体"></a>Emoji字体</h1><p>以上便是<code>Emoji</code>构成的所有规则了，但你有没有考虑过，一般字体都是黑白的矢量图形，为什么<code>Emoji</code>会显示成图片呢？</p>
<p>操作系统一般都会内置一种<code>Emoji</code>字体，<code>MacOS</code>/<code>iOS</code>内置的是<code>Apple Color Emoji</code>字体，<code>Windows</code>内置的是<code>Segoe UI Emoji</code>字体，<code>Android</code>内置的是<code>Noto Color Emoji</code>字体。这也是同一个<code>Emoji</code>再不同的设备上长得不一样的原因，除此之外，很多应用也会自带<code>Emoji</code>字体，比如<code>WhatsApp</code>、<code>Twitter</code>和<code>Facebook</code></p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_Apple_Color_Emoji.png" alt="Apple Color Emoji"></p>
<p><img src="https://github.com/dreamgyf/ImageStorage/raw/master/%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3Emoji%E5%90%97%EF%BC%9FEmoji%E5%85%A8%E8%B2%8C%E5%A4%A7%E6%8F%AD%E7%A7%98_%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E4%B8%8B%E7%9A%84Emoji%E6%A0%B7%E5%BC%8F.png" alt="不同平台下的Emoji样式"></p>
<h1 id="回归初心，如何解决流式打印问题"><a href="#回归初心，如何解决流式打印问题" class="headerlink" title="回归初心，如何解决流式打印问题"></a>回归初心，如何解决流式打印问题</h1><p>最后，让我们回到本文的出发点，了解了<code>Emoji</code>机制后，我们该如何解决AI聊天机器人的流式打印问题呢？其实很简单，根据字符串向后做一个预测就可以了，啥叫预测？就是往后匹配，看这个字符的结构当前是否符合<code>Emoji</code>规则，以及加上后面的字符后有没有可能组成一个完整的<code>Emoji</code>，这里具体的代码我就不放了，大家自行感悟吧😊</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a href="https://zh.wikipedia.org/wiki/%E7%B9%AA%E6%96%87%E5%AD%97" target="_blank" rel="noopener">Emoji 维基百科</a></li>
<li><a href="https://zh.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener">UTF-16 维基百科</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%8C%BA%E5%9F%9F%E6%8C%87%E7%A4%BA%E7%AC%A6" target="_blank" rel="noopener">区域指示符 维基百科</a></li>
<li><a href="https://tech.sina.com.cn/roll/2018-03-05/doc-ifyrztfz8047785.shtml" target="_blank" rel="noopener">总被大做文章的它从哪来？ Emoji起源和历史科普</a></li>
<li><a href="https://www.canva.cn/learn/emoji-design-and-development/" target="_blank" rel="noopener">emoji的诞生、发展背后，有哪些设计开发者的故事？</a></li>
<li><a href="https://kawo.com/cn/%E7%A4%BE%E4%BA%A4%E5%AA%92%E4%BD%93%E6%9C%AF%E8%AF%AD%E8%A1%A8/emoji" target="_blank" rel="noopener">Emoji</a></li>
<li><a href="https://liyucang-git.github.io/2019/06/17/%E5%BD%BB%E5%BA%95%E5%BC%84%E6%87%82Unicode%E7%BC%96%E7%A0%81/" target="_blank" rel="noopener">彻底弄懂Unicode编码</a></li>
<li><a href="https://blog.hackerpie.com/posts/text-processing/character-sets-and-encoding-formats/" target="_blank" rel="noopener">Unicode？UTF-8？GBK？……聊聊字符集和字符编码格式</a></li>
<li><a href="https://taoshu.in/emoji.html" target="_blank" rel="noopener">Emoji的奥秘</a></li>
<li><a href="https://www.unicode.org/reports/tr51/" target="_blank" rel="noopener">Unicode 技术标准 #51 Emoji</a></li>
</ul>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><ul>
<li><a href="https://apps.timwhitlock.info/emoji/tables/unicode" target="_blank" rel="noopener">Emoji Unicode Tables</a></li>
<li><a href="https://apps.timwhitlock.info/unicode/inspect" target="_blank" rel="noopener">Unicode character inspector</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Emoji/">Emoji</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2023/10/25/interview/2023%E5%B0%8F%E7%BA%A2%E4%B9%A6Android%E9%9D%A2%E8%AF%95%E4%B9%8B%E6%97%85/"><span>2023小红书Android面试之旅</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/images/background.jpeg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2025 By dreamgyf</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>